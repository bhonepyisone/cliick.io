
> cliick-backend@1.0.0 test
> vitest --run

The CJS build of Vite's Node API is deprecated. See https://vite.dev/guide/troubleshooting.html#vite-cjs-node-api-deprecated for more details.

[7m[1m[36m RUN [39m[22m[27m [36mv1.6.1[39m [90mC:/cliick.io-(backend-ready)-(nov-18_-2_30pm)/backend[39m

stderr | tests/webhooks.test.ts > Webhook Endpoints > POST /webhook/paypal > should fail with invalid JSON
Error: SyntaxError: Unexpected token 'i', "invalid json" is not valid JSON
    at JSON.parse (<anonymous>)
    at createStrictSyntaxError (C:\cliick.io-(backend-ready)-(nov-18_-2_30pm)\backend\node_modules\body-parser\lib\types\json.js:169:10)
    at parse (C:\cliick.io-(backend-ready)-(nov-18_-2_30pm)\backend\node_modules\body-parser\lib\types\json.js:86:15)
    at C:\cliick.io-(backend-ready)-(nov-18_-2_30pm)\backend\node_modules\body-parser\lib\read.js:128:18
    at AsyncResource.runInAsyncScope (node:async_hooks:214:14)
    at invokeCallback (C:\cliick.io-(backend-ready)-(nov-18_-2_30pm)\backend\node_modules\raw-body\index.js:238:16)
    at done (C:\cliick.io-(backend-ready)-(nov-18_-2_30pm)\backend\node_modules\raw-body\index.js:227:7)
    at IncomingMessage.onEnd (C:\cliick.io-(backend-ready)-(nov-18_-2_30pm)\backend\node_modules\raw-body\index.js:287:7)
    at IncomingMessage.emit (node:events:508:28)
    at endReadableNT (node:internal/streams/readable:1701:12) {
  expose: true,
  statusCode: 400,
  status: 400,
  body: 'invalid json',
  type: 'entity.parse.failed'
}

 [32mÎ“Â£Ã´[39m tests/webhooks.test.ts [2m ([22m[2m9 tests[22m[2m)[22m[90m 114[2mms[22m[39m
 [33mÎ“Â¥Â»[39m tests/orders.test.ts [2m ([22m[2m8 tests[22m [2m|[22m [31m5 failed[39m[2m)[22m[90m 116[2mms[22m[39m
[31m   [33mÎ“Â¥Â»[31m tests/orders.test.ts[2m > [22mOrder Endpoints[2m > [22mPOST /api/shops/:shopId/orders[2m > [22mshould create an order[39m
[31m     Î“Ã¥Ã† expected 403 to be 201 // Object.is equality[39m
[31m   [33mÎ“Â¥Â»[31m tests/orders.test.ts[2m > [22mOrder Endpoints[2m > [22mPOST /api/shops/:shopId/orders[2m > [22mshould fail without required fields[39m
[31m     Î“Ã¥Ã† expected 403 to be 400 // Object.is equality[39m
[31m   [33mÎ“Â¥Â»[31m tests/orders.test.ts[2m > [22mOrder Endpoints[2m > [22mGET /api/shops/:shopId/orders/:orderId[2m > [22mshould get order details[39m
[31m     Î“Ã¥Ã† expected 404 to be 200 // Object.is equality[39m
[31m   [33mÎ“Â¥Â»[31m tests/orders.test.ts[2m > [22mOrder Endpoints[2m > [22mPUT /api/shops/:shopId/orders/:orderId/status[2m > [22mshould update order status[39m
[31m     Î“Ã¥Ã† expected 403 to be 200 // Object.is equality[39m
[31m   [33mÎ“Â¥Â»[31m tests/orders.test.ts[2m > [22mOrder Endpoints[2m > [22mPUT /api/shops/:shopId/orders/:orderId[2m > [22mshould update full order[39m
[31m     Î“Ã¥Ã† expected 403 to be 200 // Object.is equality[39m
 [32mÎ“Â£Ã´[39m tests/notifications.test.ts [2m ([22m[2m13 tests[22m[2m)[22m[90m 128[2mms[22m[39m
 [33mÎ“Â¥Â»[39m tests/payments.test.ts [2m ([22m[2m9 tests[22m [2m|[22m [31m7 failed[39m[2m)[22m[90m 130[2mms[22m[39m
[31m   [33mÎ“Â¥Â»[31m tests/payments.test.ts[2m > [22mPayment Endpoints[2m > [22mPOST /api/shops/:shopId/payments/intent[2m > [22mshould create payment intent[39m
[31m     Î“Ã¥Ã† expected 403 to be 200 // Object.is equality[39m
[31m   [33mÎ“Â¥Â»[31m tests/payments.test.ts[2m > [22mPayment Endpoints[2m > [22mPOST /api/shops/:shopId/payments/intent[2m > [22mshould validate amount[39m
[31m     Î“Ã¥Ã† expected 403 to be 400 // Object.is equality[39m
[31m   [33mÎ“Â¥Â»[31m tests/payments.test.ts[2m > [22mPayment Endpoints[2m > [22mPOST /api/shops/:shopId/payments/intent[2m > [22mshould require required fields[39m
[31m     Î“Ã¥Ã† expected 403 to be 400 // Object.is equality[39m
[31m   [33mÎ“Â¥Â»[31m tests/payments.test.ts[2m > [22mPayment Endpoints[2m > [22mPOST /api/shops/:shopId/payments/confirm[2m > [22mshould confirm payment[39m
[31m     Î“Ã¥Ã† expected 403 to be 200 // Object.is equality[39m
[31m   [33mÎ“Â¥Â»[31m tests/payments.test.ts[2m > [22mPayment Endpoints[2m > [22mPOST /api/shops/:shopId/payments/confirm[2m > [22mshould fail without payment intent id[39m
[31m     Î“Ã¥Ã† expected 403 to be 400 // Object.is equality[39m
[31m   [33mÎ“Â¥Â»[31m tests/payments.test.ts[2m > [22mPayment Endpoints[2m > [22mGET /api/shops/:shopId/payments/:paymentId[2m > [22mshould return 404 for non-existent payment[39m
[31m     Î“Ã¥Ã† expected 200 to be 404 // Object.is equality[39m
[31m   [33mÎ“Â¥Â»[31m tests/payments.test.ts[2m > [22mPayment Endpoints[2m > [22mPOST /api/shops/:shopId/payments/:paymentId/refund[2m > [22mshould process refund[39m
[31m     Î“Ã¥Ã† expected 403 to be 200 // Object.is equality[39m
 [33mÎ“Â¥Â»[39m tests/integrations.test.ts [2m ([22m[2m9 tests[22m [2m|[22m [31m4 failed[39m[2m)[22m[90m 135[2mms[22m[39m
[31m   [33mÎ“Â¥Â»[31m tests/integrations.test.ts[2m > [22mIntegration Endpoints[2m > [22mPOST /api/shops/:shopId/integrations/:platform/connect[2m > [22mshould connect OAuth provider with code[39m
[31m     Î“Ã¥Ã† expected 403 to be 200 // Object.is equality[39m
[31m   [33mÎ“Â¥Â»[31m tests/integrations.test.ts[2m > [22mIntegration Endpoints[2m > [22mPOST /api/shops/:shopId/integrations/:platform/connect[2m > [22mshould handle different platforms[39m
[31m     Î“Ã¥Ã† expected 403 to be 200 // Object.is equality[39m
[31m   [33mÎ“Â¥Â»[31m tests/integrations.test.ts[2m > [22mIntegration Endpoints[2m > [22mPOST /api/shops/:shopId/integrations/:platform/connect[2m > [22mshould require authorization code[39m
[31m     Î“Ã¥Ã† expected 403 to be 400 // Object.is equality[39m
[31m   [33mÎ“Â¥Â»[31m tests/integrations.test.ts[2m > [22mIntegration Endpoints[2m > [22mPOST /api/shops/:shopId/integrations/:platform/disconnect[2m > [22mshould disconnect OAuth provider[39m
[31m     Î“Ã¥Ã† expected 403 to be 200 // Object.is equality[39m
[90mstdout[2m | tests/conversations.test.ts[2m > [22m[2mConversation Endpoints[22m[39m
Attempting to create user in Supabase...
Supabase user creation response: {
  createdUser: {
    email: [32m'conversation-test-1765451342478@example.com'[39m,
    username: [32m'convtest_1765451342478'[39m,
    password_hash: [32m'$2a$10$sZ4Em/ptxbaqiOBS57eSPeado1S7rO/5SCtRtkvxUANxmm6CWCtKS'[39m,
    role: [32m'USER'[39m,
    id: [32m'id_1765451342623_8o8d2bjnw'[39m,
    created_at: [32m'2025-12-11T11:09:02.623Z'[39m
  },
  error: [1mnull[22m
}
User created successfully in Supabase: id_1765451342623_8o8d2bjnw
Attempting to create profile for user: id_1765451342623_8o8d2bjnw
Profile insert response: { profileData: [90mundefined[39m, insertError: [90mundefined[39m }
Profile created successfully: id_1765451342623_8o8d2bjnw

[90mstdout[2m | tests/forms.test.ts[2m > [22m[2mForm Endpoints[22m[39m
Attempting to create user in Supabase...
Supabase user creation response: {
  createdUser: {
    email: [32m'form-test-1765451342477@example.com'[39m,
    username: [32m'formtest_1765451342477'[39m,
    password_hash: [32m'$2a$10$V8cFW9N01iUDpi/gZs6DIOkaHYoFe6GiiU3xeoD4OM/vqdOmDPg6O'[39m,
    role: [32m'USER'[39m,
    id: [32m'id_1765451342628_h39pp3w2m'[39m,
    created_at: [32m'2025-12-11T11:09:02.628Z'[39m
  },
  error: [1mnull[22m
}
User created successfully in Supabase: id_1765451342628_h39pp3w2m
Attempting to create profile for user: id_1765451342628_h39pp3w2m
Profile insert response: { profileData: [90mundefined[39m, insertError: [90mundefined[39m }
Profile created successfully: id_1765451342628_h39pp3w2m

[90mstdout[2m | tests/auth.test.ts[2m > [22m[2mAuthentication Endpoints[2m > [22m[2mPOST /api/auth/register[2m > [22m[2mshould register a new user[22m[39m
Attempting to create user in Supabase...
Supabase user creation response: {
  createdUser: {
    email: [32m'test@example.com'[39m,
    username: [32m'testuser'[39m,
    password_hash: [32m'$2a$10$OINN/1z4NdsZfr9ipjHtFeDIFCD0RC5b7QTtqLWQfKV8swphESFR.'[39m,
    role: [32m'USER'[39m,
    id: [32m'id_1765451342632_junjb8yi6'[39m,
    created_at: [32m'2025-12-11T11:09:02.632Z'[39m
  },
  error: [1mnull[22m
}
User created successfully in Supabase: id_1765451342632_junjb8yi6
Attempting to create profile for user: id_1765451342632_junjb8yi6
Profile insert response: { profileData: [90mundefined[39m, insertError: [90mundefined[39m }
Profile created successfully: id_1765451342632_junjb8yi6

[90mstdout[2m | tests/shops.test.ts[2m > [22m[2mShop Endpoints[22m[39m
Attempting to create user in Supabase...
Supabase user creation response: {
  createdUser: {
    email: [32m'shop-test-1765451342476@example.com'[39m,
    username: [32m'shoptest_1765451342476'[39m,
    password_hash: [32m'$2a$10$LkkhkniPtkFhCMXRLDDYiuUfu.TcahAK.lk3S7z0E4rcViPeWOcuG'[39m,
    role: [32m'USER'[39m,
    id: [32m'id_1765451342634_yd1p3h4gw'[39m,
    created_at: [32m'2025-12-11T11:09:02.634Z'[39m
  },
  error: [1mnull[22m
}
User created successfully in Supabase: id_1765451342634_yd1p3h4gw
Attempting to create profile for user: id_1765451342634_yd1p3h4gw
Profile insert response: { profileData: [90mundefined[39m, insertError: [90mundefined[39m }
Profile created successfully: id_1765451342634_yd1p3h4gw

[90mstdout[2m | tests/products.test.ts[2m > [22m[2mProduct Endpoints[22m[39m
Attempting to create user in Supabase...
Supabase user creation response: {
  createdUser: {
    email: [32m'product-test-1765451342476@example.com'[39m,
    username: [32m'producttest_1765451342476'[39m,
    password_hash: [32m'$2a$10$8cirn2VdYRN6.6jDh2uVTexIwUfrqZHXQ0co..4V3K4/tRCkCHLkW'[39m,
    role: [32m'USER'[39m,
    id: [32m'id_1765451342637_fbltzwe3d'[39m,
    created_at: [32m'2025-12-11T11:09:02.637Z'[39m
  },
  error: [1mnull[22m
}
User created successfully in Supabase: id_1765451342637_fbltzwe3d
Attempting to create profile for user: id_1765451342637_fbltzwe3d
Profile insert response: { profileData: [90mundefined[39m, insertError: [90mundefined[39m }
Profile created successfully: id_1765451342637_fbltzwe3d

stderr | tests/forms.test.ts > Form Endpoints > PUT /api/shops/:shopId/forms/:formId > should update form
Error: { message: 'Not found' }

 [32mÎ“Â£Ã´[39m tests/shops.test.ts [2m ([22m[2m8 tests[22m[2m)[22m[90m 237[2mms[22m[39m
stderr | tests/conversations.test.ts > Conversation Endpoints > PUT /api/shops/:shopId/conversations/:conversationId > should update conversation
Error: { message: 'Not found' }

stderr | tests/products.test.ts > Product Endpoints > PUT /api/shops/:shopId/products/:productId > should update product
Error: { message: 'Not found' }

 [33mÎ“Â¥Â»[39m tests/conversations.test.ts [2m ([22m[2m9 tests[22m [2m|[22m [31m5 failed[39m[2m)[22m[90m 263[2mms[22m[39m
[31m   [33mÎ“Â¥Â»[31m tests/conversations.test.ts[2m > [22mConversation Endpoints[2m > [22mPOST /api/shops/:shopId/conversations[2m > [22mshould create a conversation[39m
[31m     Î“Ã¥Ã† expected 400 to be 201 // Object.is equality[39m
[31m   [33mÎ“Â¥Â»[31m tests/conversations.test.ts[2m > [22mConversation Endpoints[2m > [22mGET /api/shops/:shopId/conversations/:conversationId[2m > [22mshould get conversation details[39m
[31m     Î“Ã¥Ã† expected 404 to be 200 // Object.is equality[39m
[31m   [33mÎ“Â¥Â»[31m tests/conversations.test.ts[2m > [22mConversation Endpoints[2m > [22mPUT /api/shops/:shopId/conversations/:conversationId[2m > [22mshould update conversation[39m
[31m     Î“Ã¥Ã† expected 500 to be 200 // Object.is equality[39m
[31m   [33mÎ“Â¥Â»[31m tests/conversations.test.ts[2m > [22mConversation Endpoints[2m > [22mPOST /api/shops/:shopId/conversations/:conversationId/messages[2m > [22mshould fail with invalid sender[39m
[31m     Î“Ã¥Ã† expected 401 to be 400 // Object.is equality[39m
[31m   [33mÎ“Â¥Â»[31m tests/conversations.test.ts[2m > [22mConversation Endpoints[2m > [22mPOST /api/shops/:shopId/conversations/:conversationId/messages[2m > [22mshould fail without required fields[39m
[31m     Î“Ã¥Ã† expected 401 to be 400 // Object.is equality[39m
 [32mÎ“Â£Ã´[39m tests/auth.test.ts [2m ([22m[2m14 tests[22m[2m)[22m[33m 389[2mms[22m[39m
